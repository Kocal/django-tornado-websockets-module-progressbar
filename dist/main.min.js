!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.deepmerge=t()}(this,function(){return function e(t,s){var o=Array.isArray(s),r=o&&[]||{};return o?(t=t||[],r=r.concat(t),s.forEach(function(s,o){"undefined"==typeof r[o]?r[o]=s:"object"==typeof s?r[o]=e(t[o],s):-1===t.indexOf(s)&&r.push(s)})):(t&&"object"==typeof t&&Object.keys(t).forEach(function(e){r[e]=t[e]}),Object.keys(s).forEach(function(o){r[o]="object"==typeof s[o]&&s[o]&&t[o]?e(t[o],s[o]):s[o]})),r}});var ProgressBarModuleEngineInterface;ProgressBarModuleEngineInterface=function(){function e(){throw new Error("`ProgressBarModuleEngineInterface` should be implemented as an interface.")}return e.prototype.render=function(){throw new Error("`render` method should be overridden.")},e.prototype.onInit=function(e){throw new Error("`onInit` method should be overridden.")},e.prototype.onUpdate=function(e){throw new Error("`onUpdate` method should be overridden.")},e.prototype.updateLabel=function(e){throw new Error("`updateLabel` method should be overridden.")},e.prototype.updateProgression=function(e){throw new Error("`updateProgression` method should be overridden.")},e}();var ProgressBarModuleEngineBootstrap,extend=function(e,t){function s(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;ProgressBarModuleEngineBootstrap=function(e){function t(e,t){this.container=e,this.options=t,this._settings={}}return extend(t,e),t.prototype.render=function(){this._createElements(),this._renderElements()},t.prototype.onInit=function(e){var t,s,o,r;o=[0,100,100],s=o[0],t=o[1],r=o[2],e.indeterminate===!1&&(s=e.min,t=e.max,r=e.value,this.updateProgression(0)),this._config("indeterminate",e.indeterminate),this._config("min",s),this._config("max",t),this._config("value",r)},t.prototype.onUpdate=function(e){this._config("value",e.value),this._config("progression",(this._settings.value/this._settings.max*100).toFixed()),this.$progressbar.style.width=this._settings.progression+"%",void 0!==e.label&&this.updateLabel(e.label),this.updateProgression(this._settings.progression)},t.prototype.updateLabel=function(e){this.$label.textContent=e},t.prototype.updateProgression=function(e){this.$progression.textContent=this.options.progression.format.replace(/\{\{ *percent *\}\}/g,e)},t.prototype._createElements=function(){var e,t,s,o,r;for(this.$progress=document.createElement("div"),this.$progress.classList.add("progress"),this.$progressbar=document.createElement("div"),this.$progressbar.classList.add("progress-bar"),this.$progressbar.setAttribute("role","progressbar"),("info"===(o=this.options.progressbar.context)||"success"===o||"warning"===o||"danger"===o)&&this.$progressbar.classList.add("progress-bar-"+this.options.progressbar.context),this.options.progressbar.striped===!0&&this.$progressbar.classList.add("progress-bar-striped"),this.options.progressbar.animated===!0&&this.$progressbar.classList.add("active"),this.$progression=document.createElement("span"),this.options.progression.visible===!1&&this.$progression.classList.add("sr-only"),this.$label=document.createElement("span"),r=this.options.label.classes,t=0,s=r.length;s>t;t++)e=r[t],this.$label.classList.add(e);this.options.label.visibility===!1&&(this.$label.style.display="none")},t.prototype._renderElements=function(){this.$progressbar.appendChild(this.$progression),this.$progress.appendChild(this.$progressbar),this.container.appendChild(this.$progress),"top"===this.options.label.position?this.container.insertBefore(this.$label,this.$progress):this.container.appendChild(this.$label)},t.prototype._config=function(e,t){switch(this._settings[e]=t,e){case"min":case"max":case"value":this.$progressbar.setAttribute("aria-value"+e,t);break;case"indeterminate":t===!0&&(this.$progressbar.classList.add("progress-bar-striped"),this.$progressbar.classList.add("active"),this.$progressbar.style.width="100%")}},t}(ProgressBarModuleEngineInterface);var ProgressBarModule;ProgressBarModule=function(){function e(t,s,o){if(null==o&&(o={}),!(this instanceof e))return new e(t,s,o);if(void 0===t)throw new Error("You must pass 'path' parameter during 'ProgressBarModule' instantiation.");if(void 0===s||!(s instanceof HTMLElement))throw new Error("You must pass an HTML element as container during `ProgressBarModule` instantiation.");switch(this.path=t.trim(),this.path="/"===this.path[0]?this.path:"/"+this.path,this.container=s,this.options={websocket:{},type:"bootstrap",bootstrap:{label:{visible:!0,classes:["progressbar-label"],position:"top"},progressbar:{context:"info",striped:!1,animated:!1},progression:{visible:!0,format:"{{percent}}%"}},html5:{label:{visible:!0,classes:["progressbar-label"],position:"top"},progression:{visible:!0,position:"right",format:"{{percent}}%"}}},this.options=deepmerge(this.options,o),this.engine=null,this.options.type){case"bootstrap":this.engine=new ProgressBarModuleEngineBootstrap(this.container,this.options.bootstrap);break;case"html5":this.engine=new ProgressBarModuleEngineHtml5(this.container,this.options.html5);break;default:throw new Error("Given `type` should be equal to ``bootstrap`` or ``html5``.")}this.websocket=new TornadoWebSocket("/module/progress_bar"+t,this.options.websocket),this.init()}return e.prototype.init=function(){return this.websocket.on("init",function(e){return function(t){return e.engine.onInit.apply(e.engine,[t])}}(this)),this.websocket.on("update",function(e){return function(t){return e.engine.onUpdate.apply(e.engine,[t])}}(this)),this.engine.render()},e.prototype.on=function(e,t){return this.websocket.on(e,t)},e.prototype.emit=function(e,t){return null==t&&(t={}),this.websocket.emit(e,t)},e.prototype.close=function(){return this.websocket.ws.close()},e}();