!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.deepmerge=e()}(this,function(){return function t(e,s){var o=Array.isArray(s),r=o&&[]||{};return o?(e=e||[],r=r.concat(e),s.forEach(function(s,o){"undefined"==typeof r[o]?r[o]=s:"object"==typeof s?r[o]=t(e[o],s):-1===e.indexOf(s)&&r.push(s)})):(e&&"object"==typeof e&&Object.keys(e).forEach(function(t){r[t]=e[t]}),Object.keys(s).forEach(function(o){r[o]="object"==typeof s[o]&&s[o]&&e[o]?t(e[o],s[o]):s[o]})),r}});var ProgressBarModuleEngine;ProgressBarModuleEngine=function(){function t(t,e){this.container=t,this.options=e}return t.prototype.render=function(){throw new Error("`render` method should be overridden.")},t.prototype.onInit=function(t){throw new Error("`onInit` method should be overridden.")},t.prototype.onUpdate=function(t){throw new Error("`onUpdate` method should be overridden.")},t.prototype.updateLabel=function(t){throw new Error("`updateLabel` method should be overridden.")},t.prototype.updateProgression=function(t){throw new Error("`updateProgression` method should be overridden.")},t}();var ProgressBarModuleEngineBootstrap,extend=function(t,e){function s(){this.constructor=t}for(var o in e)hasProp.call(e,o)&&(t[o]=e[o]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;ProgressBarModuleEngineBootstrap=function(t){function e(t,s){e.__super__.constructor.call(this,t,s),this._settings={}}return extend(e,t),e.prototype.render=function(){this._createElements(),this._renderElements()},e.prototype.onInit=function(t){var e,s,o,r;o=[0,100,100],s=o[0],e=o[1],r=o[2],t.indeterminate===!1&&(s=t.min,e=t.max,r=t.value,this.updateProgression(0)),this._config("indeterminate",t.indeterminate),this._config("min",s),this._config("max",e),this._config("value",r)},e.prototype.onUpdate=function(t){this._config("value",t.value),this._config("progression",(this._settings.value/this._settings.max*100).toFixed()),this.$progressbar.style.width=this._settings.progression+"%",void 0!==t.label&&this.updateLabel(t.label),this.updateProgression(this._settings.progression)},e.prototype.updateLabel=function(t){this.$label.textContent=t},e.prototype.updateProgression=function(t){this.$progression.textContent=this.options.progression.format.replace(/\{\{ *percent *\}\}/g,t)},e.prototype._createElements=function(){var t,e,s,o,r;for(this.$progress=document.createElement("div"),this.$progress.classList.add("progress"),this.$progressbar=document.createElement("div"),this.$progressbar.classList.add("progress-bar"),this.$progressbar.setAttribute("role","progressbar"),("info"===(o=this.options.progressbar.context)||"success"===o||"warning"===o||"danger"===o)&&this.$progressbar.classList.add("progress-bar-"+this.options.progressbar.context),this.options.progressbar.striped===!0&&this.$progressbar.classList.add("progress-bar-striped"),this.options.progressbar.animated===!0&&this.$progressbar.classList.add("active"),this.$progression=document.createElement("span"),this.options.progression.visible===!1&&this.$progression.classList.add("sr-only"),this.$label=document.createElement("span"),r=this.options.label.classes,e=0,s=r.length;s>e;e++)t=r[e],this.$label.classList.add(t);this.options.label.visibility===!1&&(this.$label.style.display="none")},e.prototype._renderElements=function(){this.$progressbar.appendChild(this.$progression),this.$progress.appendChild(this.$progressbar),this.container.appendChild(this.$progress),"top"===this.options.label.position?this.container.insertBefore(this.$label,this.$progress):this.container.appendChild(this.$label)},e.prototype._config=function(t,e){switch(this._settings[t]=e,t){case"min":case"max":case"value":this.$progressbar.setAttribute("aria-value"+t,e);break;case"indeterminate":e===!0&&(this.$progressbar.classList.add("progress-bar-striped"),this.$progressbar.classList.add("active"),this.$progressbar.style.width="100%")}},e}(ProgressBarModuleEngine);var ProgressBarModule;ProgressBarModule=function(){function t(e,s,o){if(null==o&&(o={}),!(this instanceof t))return new t(e,s,o);if(void 0===e)throw new Error("You must pass 'path' parameter during 'ProgressBarModule' instantiation.");if(void 0===s||!(s instanceof HTMLElement))throw new Error("You must pass an HTML element as container during `ProgressBarModule` instantiation.");switch(this.path=e.trim(),this.path="/"===this.path[0]?this.path:"/"+this.path,this.container=s,this.options={websocket:{},type:"bootstrap",bootstrap:{label:{visible:!0,classes:["progressbar-label"],position:"top"},progressbar:{context:"info",striped:!1,animated:!1},progression:{visible:!0,format:"{{percent}}%"}},html5:{label:{visible:!0,classes:["progressbar-label"],position:"top"},progression:{visible:!0,position:"right",format:"{{percent}}%"}}},this.options=deepmerge(this.options,o),this.engine=null,this.options.type){case"bootstrap":this.engine=new ProgressBarModuleEngineBootstrap(this.container,this.options.bootstrap);break;case"html5":this.engine=new ProgressBarModuleEngineHtml5(this.container,this.options.html5);break;default:throw new Error("Given `type` should be equal to ``bootstrap`` or ``html5``.")}this.websocket=new TornadoWebSocket("/module/progress_bar"+e,this.options.websocket),this.init()}return t.prototype.init=function(){return this.websocket.on("init",function(t){return function(e){return t.engine.onInit.apply(t.engine,[e])}}(this)),this.websocket.on("update",function(t){return function(e){return t.engine.onUpdate.apply(t.engine,[e])}}(this)),this.engine.render()},t.prototype.on=function(t,e){return this.websocket.on(t,e)},t.prototype.emit=function(t,e){return null==e&&(e={}),this.websocket.emit(t,e)},t.prototype.close=function(){return this.websocket.ws.close()},t}();